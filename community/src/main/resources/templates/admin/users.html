<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
  <head
    th:replace="~{fragments/layout :: head('Moderacja Użytkowników')}"
  ></head>
  <body>
    <nav th:replace="~{fragments/layout :: navigation}"></nav>

    <div class="container mt-4">
      <h2>Moderacja Użytkowników</h2>

      <div
        th:if="${param.deleted}"
        class="alert alert-warning alert-dismissible fade show"
        role="alert"
      >
        Użytkownik został trwale usunięty, a jego dane zanonimizowane.
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>

      <a href="/admin" class="btn btn-outline-secondary mb-3">← Powrót</a>

      <table class="table align-middle">
        <thead>
          <tr>
            <th>ID</th>
            <th>Login</th>
            <th>Email</th>
            <th>Status</th>
            <th>Akcja</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="u : ${users}">
            <td th:text="${u.id}">1</td>
            <td th:text="${u.username}">Jan</td>
            <td th:text="${u.email}">jan@o2.pl</td>
            <td>
              <span th:if="${u.enabled}" class="badge bg-success">Aktywny</span>
              <span th:unless="${u.enabled}" class="badge bg-danger"
                >Zablokowany</span
              >
            </td>
            <td>
              <div class="d-flex gap-2" th:if="${u.role != 'ROLE_ADMIN'}">
                <a
                  th:href="@{'/admin/users/toggle-block/' + ${u.id}}"
                  class="btn btn-sm"
                  th:classappend="${u.enabled} ? 'btn-outline-warning' : 'btn-success'"
                  th:text="${u.enabled} ? 'Zablokuj' : 'Odblokuj'"
                >
                </a>

                <form
                  th:action="@{'/admin/users/' + ${u.id} + '/delete'}"
                  method="post"
                  onsubmit="
                    return confirm(
                      'Czy na pewno chcesz trwale usunąć tego użytkownika? \n\nUWAGA: Konto zostanie usunięte, półki wyczyszczone, a recenzje zanonimizowane. Tej operacji nie można cofnąć.',
                    );
                  "
                >
                  <button type="submit" class="btn btn-sm btn-danger">
                    Usuń
                  </button>
                </form>
              </div>

              <span
                th:if="${u.role == 'ROLE_ADMIN'}"
                class="text-muted fst-italic small"
              >
                Administrator
              </span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </body>
</html>
